#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

BUILD_DIR=$1
CACHE_DIR=$2
#set -e # fail fast
#set -o pipefail

echo "-----> Starting perl buildpack"

cd $BUILD_DIR

PERLBREW_PACKAGE=http://install.perlbrew.pl/
VENDORED_PERL="$BUILD_DIR/vendor/perl"
export PERLBREW_ROOT=$VENDORED_PERL

echo "-----> Vendoring Perl"

mkdir -p $VENDORED_PERL  && curl -L -s $PERLBREW_PACKAGE | bash
source $PERLBREW_ROOT/etc/bashrc

perlbrew install perl-stable

echo "-----> Installing cpanm"

perlbrew install-cpanm

echo "-----> Done"

exit 0

